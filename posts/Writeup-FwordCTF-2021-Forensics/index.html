<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[Writeup] FwordCTF 2021 - Forensics" /><meta name="author" content="F4c3l3ss_" /><meta property="og:locale" content="en" /><meta name="description" content="listening?" /><meta property="og:description" content="listening?" /><link rel="canonical" href="https://blog.whitebear.vn/posts/Writeup-FwordCTF-2021-Forensics/" /><meta property="og:url" content="https://blog.whitebear.vn/posts/Writeup-FwordCTF-2021-Forensics/" /><meta property="og:site_name" content="WhiteBearVN" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-29T00:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Writeup] FwordCTF 2021 - Forensics" /><meta name="twitter:site" content="@WhiteBearVN_" /><meta name="twitter:creator" content="@F4c3l3ss_" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"F4c3l3ss_"},"dateModified":"2021-08-29T00:00:00+07:00","datePublished":"2021-08-29T00:00:00+07:00","description":"listening?","headline":"[Writeup] FwordCTF 2021 - Forensics","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.whitebear.vn/posts/Writeup-FwordCTF-2021-Forensics/"},"url":"https://blog.whitebear.vn/posts/Writeup-FwordCTF-2021-Forensics/"}</script><title>[Writeup] FwordCTF 2021 - Forensics | WhiteBearVN</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="WhiteBearVN"><meta name="application-name" content="WhiteBearVN"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/logo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">WhiteBearVN</a></div><div class="site-subtitle font-italic">Thought on cyber security</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/WhiteBearVN" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/WhiteBearVN_" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['binhbear.vn','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[Writeup] FwordCTF 2021 - Forensics</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[Writeup] FwordCTF 2021 - Forensics</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1630170000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 29, 2021 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2292 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h2 id="listening"><span class="mr-2">listening?</span><a href="#listening" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Chúng ta có đề bài là một file pcap. Sau khi nhìn tổng quan thì tất cả các package đều chỉ chung về việc truy cập <code class="language-plaintext highlighter-rouge">OAUTH2</code> của google kèm theo đó là các biến <code class="language-plaintext highlighter-rouge">client_secret</code>; <code class="language-plaintext highlighter-rouge">refresh_token</code>;…</p><p><a href="/assets/img/blog/fword2021/2-flag-listening.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/2-flag-listening.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Response trả lỗi 403, yêu cầu SSL vì đây là truy vấn HTTP nên server không đáp ứng yêu cầu này.</p><p>Mình thử với burpsuite để kiểm tra tính xác thực của các biến trên.</p><p><a href="/assets/img/blog/fword2021/7-burpsuite.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/7-burpsuite.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Chú ý đến giá trị <code class="language-plaintext highlighter-rouge">Scope: https://www.googleapis.com/auth/gmail.readonly</code>. Điều này có nghĩa là các giá trị, token này sẽ cho phép chúng ta đọc được gmail thông qua API của google.</p><p>Tìm kiếm trên Internet, mình có được tài liệu đầy đủ: <a href="https://developers.google.com/gmail/api/reference/rest">https://developers.google.com/gmail/api/reference/rest</a> và video hướng dẫn: <a href="https://www.youtube.com/watch?v=x7uG1-H0aDU">https://www.youtube.com/watch?v=x7uG1-H0aDU</a>.</p><p>Sử dụng postman, set up môi trường theo video và có được flag:</p><p><a href="/assets/img/blog/fword2021/8-flag.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/8-flag.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Flag: <code class="language-plaintext highlighter-rouge">FwordCTF{email_forensics_is_interesting_73489nn7n4891}</code></p><h2 id="crypt"><span class="mr-2">Crypt</span><a href="#crypt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/img/blog/fword2021/3-crypt-debai.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/3-crypt-debai.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Download: <a href="https://drive.google.com/drive/folders/11KSbrlsTUuhPmGRx5uDjyaJvIR-_gBO8?usp=sharing">Link 1</a>; <a href="https://www.dropbox.com/sh/ipxelxzufpya66s/AAAFVi4cL-sdI0Hj9LGbMd8_a?dl=0">Link 2</a>; <a href="https://mega.nz/folder/0tQy0DCS#f5Q2kLogc7KJs4_y74HkEw">Link 3</a></p><p>Đề bài yêu cầu tìm 3 giá trị là ngày giờ nhận mail, người gửi và nội dung file đã bị mã hóa. Trước hết thì mình sử dụng volatility xem thử file dump này có thể có được thông tin từ các tiến trình đang chạy hay không.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="nv">$python2</span> vol.py <span class="nt">-f</span> challenge.raw <span class="nt">--profile</span><span class="o">=</span>Win7SP1x64 pslist
Volatility Foundation Volatility Framework 2.6.1
Offset<span class="o">(</span>V<span class="o">)</span>          Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          
<span class="nt">------------------</span> <span class="nt">--------------------</span> <span class="nt">------</span> <span class="nt">------</span> <span class="nt">------</span> <span class="nt">--------</span> <span class="nt">------</span> <span class="nt">------</span> <span class="nt">------------------------------</span> <span class="nt">------------------------------</span>
0xfffffa8018d41890 System                    4      0     76      492 <span class="nt">------</span>      0 2021-08-20 15:30:36 UTC+0000                                 
0xfffffa8019506650 smss.exe                236      4      2       29 <span class="nt">------</span>      0 2021-08-20 15:30:36 UTC+0000                                 
0xfffffa8019158060 csrss.exe               308    300      8      338      0      0 2021-08-20 15:30:42 UTC+0000                                 
0xfffffa8018db9840 wininit.exe             356    300      3       76      0      0 2021-08-20 15:30:43 UTC+0000                                 
0xfffffa8018dbe060 csrss.exe               364    348     10      222      1      0 2021-08-20 15:30:43 UTC+0000                                 
0xfffffa801a179060 winlogon.exe            392    348      4      114      1      0 2021-08-20 15:30:43 UTC+0000                                 
0xfffffa801a1b17c0 services.exe            452    356      7      183      0      0 2021-08-20 15:30:45 UTC+0000                                 
0xfffffa801a1b97f0 lsass.exe               460    356      6      511      0      0 2021-08-20 15:30:45 UTC+0000                                 
0xfffffa801a1c4b30 lsm.exe                 468    356     10      138      0      0 2021-08-20 15:30:45 UTC+0000                                 
0xfffffa801a234b30 svchost.exe             560    452     10      340      0      0 2021-08-20 15:30:49 UTC+0000                                 
0xfffffa801a25db30 svchost.exe             624    452      6      239      0      0 2021-08-20 15:30:50 UTC+0000                                 
0xfffffa801a29bb30 svchost.exe             724    452     20      443      0      0 2021-08-20 15:30:51 UTC+0000                                 
0xfffffa801a2b3920 svchost.exe             768    452     19      417      0      0 2021-08-20 15:30:51 UTC+0000                                 
0xfffffa801a2bb660 svchost.exe             792    452     32      908      0      0 2021-08-20 15:30:51 UTC+0000                                 
0xfffffa801a2e1b30 audiodg.exe             884    724      5      125      0      0 2021-08-20 15:30:53 UTC+0000                                 
0xfffffa801a30d890 svchost.exe             964    452     10      252      0      0 2021-08-20 15:30:55 UTC+0000                                 
0xfffffa801a354b30 svchost.exe             284    452     13      346      0      0 2021-08-20 15:30:57 UTC+0000                                 
0xfffffa801a3cb420 spoolsv.exe            1080    452     12      265      0      0 2021-08-20 15:31:01 UTC+0000                                 
0xfffffa801a38bb30 svchost.exe            1112    452     18      313      0      0 2021-08-20 15:31:01 UTC+0000                                 
0xfffffa801a44a340 armsvc.exe             1232    452      4       63      0      1 2021-08-20 15:31:03 UTC+0000                                 
0xfffffa801a4b4350 svchost.exe            1292    452     11      173      0      0 2021-08-20 15:31:05 UTC+0000                                 
0xfffffa80198b44e0 taskhost.exe           1784    452      9      174      1      0 2021-08-20 15:31:38 UTC+0000                                 
0xfffffa801a5e8b30 dwm.exe                1856    768      3       70      1      0 2021-08-20 15:31:38 UTC+0000                                 
0xfffffa801a5f7b30 explorer.exe           1884   1848     32      970      1      0 2021-08-20 15:31:39 UTC+0000                                 
0xfffffa80192f9b30 StikyNot.exe            512   1884      9      138      1      0 2021-08-20 15:31:43 UTC+0000                                 
0xfffffa801a677b30 SSScheduler.ex          832   1884      1       59      1      1 2021-08-20 15:31:44 UTC+0000                                 
0xfffffa801a28a060 SearchIndexer.         1344    452     12      645      0      0 2021-08-20 15:31:46 UTC+0000                                 
0xfffffa801a6cd910 SearchProtocol         1704   1344      6      310      0      0 2021-08-20 15:31:48 UTC+0000                                 
0xfffffa8019160630 notepad.exe             596    440      1       64      1      0 2021-08-20 15:32:29 UTC+0000                                 
0xfffffa8018e85b30 notepad.exe            1724    304      1       64      1      0 2021-08-20 15:32:58 UTC+0000                                 
0xfffffa80198c5870 sppsvc.exe             1852    452      4      141      0      0 2021-08-20 15:33:09 UTC+0000                                 
0xfffffa80198c5340 svchost.exe             304    452     13      317      0      0 2021-08-20 15:33:10 UTC+0000                                 
0xfffffa8019935b30 notepad.exe             840   1800      1       64      1      0 2021-08-20 15:33:10 UTC+0000                                 
0xfffffa801a17e060 notepad.exe             992   1780      1       64      1      0 2021-08-20 15:33:39 UTC+0000                                 
0xfffffa801a333630 notepad.exe            2164   1884      1       60      1      0 2021-08-20 15:34:24 UTC+0000                                 
0xfffffa801a6e0750 SearchFilterHo         2180   1344      4       85      0      0 2021-08-20 15:34:48 UTC+0000                                 
0xfffffa801a351630 WmiPrvSE.exe           2308    560      7      116      0      0 2021-08-20 15:35:09 UTC+0000                                 
0xfffffa801a3df610 DumpIt.exe             2512   1884      2       45      1      1 2021-08-20 15:35:16 UTC+0000                                 
0xfffffa801a3e2840 conhost.exe            2536    364      2       53      1      0 2021-08-20 15:35:16 UTC+0000
</pre></table></code></div></div><p>Để ý thì thấy rất nhiều tiến trình <code class="language-plaintext highlighter-rouge">notepad.exe</code> đang chạy. Chúng ta có thể dump memory của tiến trình để xem nội dung file mà notepad đang mở, tuy nhiên thì nó sẽ hơi noise và nhiều dữ liệu nên trước tiên thì mình dùng plugin <code class="language-plaintext highlighter-rouge">cmdline</code> để xem notepad đang mở những file nào và đường dẫn của những file này trên memory.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
</pre><td class="rouge-code"><pre><span class="nv">$python2</span> vol.py <span class="nt">-f</span> challenge.raw <span class="nt">--profile</span><span class="o">=</span>Win7SP1x64 cmdline
Volatility Foundation Volatility Framework 2.6.1
<span class="k">************************************************************************</span>
System pid:      4
<span class="k">************************************************************************</span>
smss.exe pid:    236
Command line : <span class="se">\S</span>ystemRoot<span class="se">\S</span>ystem32<span class="se">\s</span>mss.exe
<span class="k">************************************************************************</span>
csrss.exe pid:    308
Command line : %SystemRoot%<span class="se">\s</span>ystem32<span class="se">\c</span>srss.exe <span class="nv">ObjectDirectory</span><span class="o">=</span><span class="se">\W</span>indows <span class="nv">SharedSection</span><span class="o">=</span>1024,20480,768 <span class="nv">Windows</span><span class="o">=</span>On <span class="nv">SubSystemType</span><span class="o">=</span>Windows <span class="nv">ServerDll</span><span class="o">=</span>basesrv,1 <span class="nv">ServerDll</span><span class="o">=</span>winsrv:UserServerDllInitialization,3 <span class="nv">ServerDll</span><span class="o">=</span>winsrv:ConServerDllInitialization,2 <span class="nv">ServerDll</span><span class="o">=</span>sxssrv,4 <span class="nv">ProfileControl</span><span class="o">=</span>Off <span class="nv">MaxRequestThreads</span><span class="o">=</span>16
<span class="k">************************************************************************</span>
wininit.exe pid:    356
Command line : wininit.exe
<span class="k">************************************************************************</span>
csrss.exe pid:    364
Command line : %SystemRoot%<span class="se">\s</span>ystem32<span class="se">\c</span>srss.exe <span class="nv">ObjectDirectory</span><span class="o">=</span><span class="se">\W</span>indows <span class="nv">SharedSection</span><span class="o">=</span>1024,20480,768 <span class="nv">Windows</span><span class="o">=</span>On <span class="nv">SubSystemType</span><span class="o">=</span>Windows <span class="nv">ServerDll</span><span class="o">=</span>basesrv,1 <span class="nv">ServerDll</span><span class="o">=</span>winsrv:UserServerDllInitialization,3 <span class="nv">ServerDll</span><span class="o">=</span>winsrv:ConServerDllInitialization,2 <span class="nv">ServerDll</span><span class="o">=</span>sxssrv,4 <span class="nv">ProfileControl</span><span class="o">=</span>Off <span class="nv">MaxRequestThreads</span><span class="o">=</span>16
<span class="k">************************************************************************</span>
winlogon.exe pid:    392
Command line : winlogon.exe
<span class="k">************************************************************************</span>
services.exe pid:    452
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>ervices.exe
<span class="k">************************************************************************</span>
lsass.exe pid:    460
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\l</span>sass.exe
<span class="k">************************************************************************</span>
lsm.exe pid:    468
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\l</span>sm.exe
<span class="k">************************************************************************</span>
svchost.exe pid:    560
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> DcomLaunch
<span class="k">************************************************************************</span>
svchost.exe pid:    624
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> RPCSS
<span class="k">************************************************************************</span>
svchost.exe pid:    724
Command line : C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> LocalServiceNetworkRestricted
<span class="k">************************************************************************</span>
svchost.exe pid:    768
Command line : C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> LocalSystemNetworkRestricted
<span class="k">************************************************************************</span>
svchost.exe pid:    792
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> netsvcs
<span class="k">************************************************************************</span>
audiodg.exe pid:    884
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\A</span>UDIODG.EXE 0x2d8
<span class="k">************************************************************************</span>
svchost.exe pid:    964
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> LocalService
<span class="k">************************************************************************</span>
svchost.exe pid:    284
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> NetworkService
<span class="k">************************************************************************</span>
spoolsv.exe pid:   1080
Command line : C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\s</span>poolsv.exe
<span class="k">************************************************************************</span>
svchost.exe pid:   1112
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> LocalServiceNoNetwork
<span class="k">************************************************************************</span>
armsvc.exe pid:   1232
Command line : <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogram Files (x86)</span><span class="se">\C</span><span class="s2">ommon Files</span><span class="se">\A</span><span class="s2">dobe</span><span class="se">\A</span><span class="s2">RM</span><span class="se">\1</span><span class="s2">.0</span><span class="se">\a</span><span class="s2">rmsvc.exe"</span>
<span class="k">************************************************************************</span>
svchost.exe pid:   1292
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> LocalServiceAndNoImpersonation
<span class="k">************************************************************************</span>
taskhost.exe pid:   1784
Command line : <span class="s2">"taskhost.exe"</span>
<span class="k">************************************************************************</span>
dwm.exe pid:   1856
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\D</span><span class="s2">wm.exe"</span>
<span class="k">************************************************************************</span>
explorer.exe pid:   1884
Command line : C:<span class="se">\W</span>indows<span class="se">\E</span>xplorer.EXE
<span class="k">************************************************************************</span>
StikyNot.exe pid:    512
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\S</span><span class="s2">ystem32</span><span class="se">\S</span><span class="s2">tikyNot.exe"</span> 
<span class="k">************************************************************************</span>
SSScheduler.ex pid:    832
Command line : <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogram Files (x86)</span><span class="se">\M</span><span class="s2">cAfee Security Scan</span><span class="se">\3</span><span class="s2">.11.1664</span><span class="se">\S</span><span class="s2">SScheduler.exe"</span> 
<span class="k">************************************************************************</span>
SearchIndexer. pid:   1344
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\S</span>earchIndexer.exe /Embedding
<span class="k">************************************************************************</span>
SearchProtocol pid:   1704
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\S</span><span class="s2">earchProtocolHost.exe"</span> Global<span class="se">\U</span>sGthrFltPipeMssGthrPipe1_ Global<span class="se">\U</span>sGthrCtrlFltPipeMssGthrPipe1 1 <span class="nt">-2147483646</span> <span class="s2">"Software</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\W</span><span class="s2">indows Search"</span> <span class="s2">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT; MS Search 4.0 Robot)"</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogramData</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\S</span><span class="s2">earch</span><span class="se">\D</span><span class="s2">ata</span><span class="se">\T</span><span class="s2">emp</span><span class="se">\u</span><span class="s2">sgthrsvc"</span> <span class="s2">"DownLevelDaemon"</span> 
<span class="k">************************************************************************</span>
notepad.exe pid:    596
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\N</span><span class="s2">OTEPAD.EXE"</span> C:<span class="se">\U</span>sers<span class="se">\S</span>emahAB<span class="se">\D</span>ownloads<span class="se">\S</span>ecret content<span class="se">\f</span>lag.txt.asc
<span class="k">************************************************************************</span>
notepad.exe pid:   1724
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\N</span><span class="s2">OTEPAD.EXE"</span> C:<span class="se">\U</span>sers<span class="se">\S</span>emahAB<span class="se">\A</span>ppData<span class="se">\R</span>oaming<span class="se">\T</span>hunderbird<span class="se">\P</span>rofiles<span class="se">\g</span>b1i6asd.default-release<span class="se">\I</span>mapMail<span class="se">\i</span>map.yandex.com<span class="se">\I</span>NBOX
<span class="k">************************************************************************</span>
sppsvc.exe pid:   1852
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>ppsvc.exe
<span class="k">************************************************************************</span>
svchost.exe pid:    304
Command line : C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> secsvcs
<span class="k">************************************************************************</span>
notepad.exe pid:    840
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\N</span><span class="s2">OTEPAD.EXE"</span> C:<span class="se">\U</span>sers<span class="se">\S</span>emahAB<span class="se">\A</span>ppData<span class="se">\R</span>oaming<span class="se">\T</span>hunderbird<span class="se">\P</span>rofiles<span class="se">\g</span>b1i6asd.default-release<span class="se">\I</span>mapMail<span class="se">\i</span>map.yandex.com<span class="se">\S</span>pam
<span class="k">************************************************************************</span>
notepad.exe pid:    992
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\N</span><span class="s2">OTEPAD.EXE"</span> C:<span class="se">\U</span>sers<span class="se">\S</span>emahAB<span class="se">\A</span>ppData<span class="se">\R</span>oaming<span class="se">\T</span>hunderbird<span class="se">\P</span>rofiles<span class="se">\g</span>b1i6asd.default-release<span class="se">\I</span>mapMail<span class="se">\i</span>map.yandex.com<span class="se">\T</span>rash
<span class="k">************************************************************************</span>
notepad.exe pid:   2164
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\n</span><span class="s2">otepad.exe"</span> 
<span class="k">************************************************************************</span>
SearchFilterHo pid:   2180
Command line : <span class="s2">"C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\S</span><span class="s2">earchFilterHost.exe"</span> 0 504 508 516 65536 512 
<span class="k">************************************************************************</span>
WmiPrvSE.exe pid:   2308
Command line : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\w</span>bem<span class="se">\w</span>miprvse.exe
<span class="k">************************************************************************</span>
DumpIt.exe pid:   2512
Command line : <span class="s2">"C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\S</span><span class="s2">emahAB</span><span class="se">\D</span><span class="s2">ownloads</span><span class="se">\D</span><span class="s2">umpIt.exe"</span> 
<span class="k">************************************************************************</span>
conhost.exe pid:   2536
Command line : <span class="se">\?</span>?<span class="se">\C</span>:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\c</span>onhost.exe
</pre></table></code></div></div><p>Khá nhiều thông tin hay ho, bao gồm nội dung inbox của email, spam, trash và cùng với đó là file <code class="language-plaintext highlighter-rouge">flag.txt.asc</code>, đây có thể là mảnh ghép đầu tiên trong flag. Dump file này cho mình kết quả:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="nv">$python2</span> vol.py <span class="nt">-f</span> challenge.raw <span class="nt">--profile</span><span class="o">=</span>Win7SP1x64 filescan | <span class="nb">grep</span> <span class="s2">".txt.asc"</span>
Volatility Foundation Volatility Framework 2.6.1
0x000000007fb5d2e0     16      0 R--rw- <span class="se">\D</span>evice<span class="se">\H</span>arddiskVolume2<span class="se">\U</span>sers<span class="se">\S</span>emahAB<span class="se">\D</span>ownloads<span class="se">\S</span>ecret content<span class="se">\f</span>lag.txt.asc
<span class="nv">$python2</span> vol.py <span class="nt">-f</span> challenge.raw <span class="nt">--profile</span><span class="o">=</span>Win7SP1x64 dumpfiles <span class="nt">-Q</span> 0x000000007fb5d2e0 <span class="nt">-D</span> <span class="nb">.</span>
<span class="nv">$cat</span> flag.txt.asc
<span class="nt">-----BEGIN</span> PGP MESSAGE-----

hQIMA6mGMG+kfeOaAQ/+K8a+2BQVT+Ixk6xJKytj0xbDUqfw7FUQuKLjWBcxddbn
hd8eKmWIswUYpV3PmluCqJE5LRkdpX3Rdu/iK2ZRNyK7fGA3R3r3KFiBn5qKj0S4
D47LqwDE/fpo5YUGt3GH6Cpujv3DrdIpXcn2yFZLBiho5415bcTn2D3qm/H6uz9N
JFzved20D05OxTjj+a4s8Jsf7eroBj7DSIvvbD5/SF85rO1u1iQQHif2Na1CyrXX
sJyAU59iVipWgjo1uoGfD8PqnhJdctnTbxu2oYY6MpnQ6K98WI6hwyo/crwUGJU1
nQ8JKEQrirmcbZLsHb1fzmLDsEf2f0prG1QJXA3a9panz3N+TvIXvoWRXLkLgOcj
KjK3NjZOlnsngcXNfaSIeZelskfCg096cUiEnfUeDDc8CaGFPO4uGnhnVo/bcEFM
AuAiegy0/avdVIOU/Ho2o3ON6cQceYlsZD/Viy6oeNSib1Iyu3FLO1ZQMiaPZ6j3
Ewrfag7mr5AOLM11WtYJRYtQh2oLV5hYsvxylxZOGdIJ05hDj/CdEcxYLQ0cv3xJ
xi4shl99rGgYL2NGALrL5pnjCBDBzAdIhKImlSZmurA+29/8iE5If+NJk86SQhNl
lhSF+jIrApsQkl0cTPoE+GPmA9QicMXeLXXB+iJjDG7MVOMX1aeJROmvGWTOxBTS
swFiIgGBQQHE4cjQh8soViVMP7tOkraCYZRYGTxlrFJiCeI38gk7hx0n0hMnfMyy
lzzAKo8Fvt69q6smjOns0MhFVIfT4bUrb0md7KMXqn/OvtP/L/S9IEKjsMvk7yl6
wrLYGYwBeIgfHqPIML0DxOuqV9WKWPoigazdRVW2hQqyEjqbJRG/GIyfaisMxNlT
O+BIdWAsM3f7+gytkvmFo4lnR+Y7yVOL618HSBhie2SFwGNu
<span class="o">=</span>YEJl
<span class="nt">-----END</span> PGP MESSAGE-----
</pre></table></code></div></div><p>Mình cũng không bất ngờ nhiều khi nội dung file đã bị mã hóa vì theo đề bài thì chúng ta cần tìm cách decrypt thông qua mail mà user gửi và nhận. Tiếp tục dump các file INBOX, SPAM, TRASH.</p><p>IBOX: Trong phần này mình chú ý đến email của <code class="language-plaintext highlighter-rouge">ctf.user</code>. Chúng ta có đoạn base64 dài cần decode. Kết quả thu được là file key để giải mã PGP. Nhưng khi mình import thì lại cần passphrase để mở key. Tiếp tục đi tìm nào.</p><p>TRASH: Mình hy vọng là user sẽ xóa mail chứa passphrase, tuy nhiên thì file này lại không cho chúng ta thông tin gì.</p><p>SPAM: Cho mình một chi tiết rất quan trọng: <code class="language-plaintext highlighter-rouge">But we used the same secret as your EN VAR 345YACCESSTOGENERATEP455</code>. Mình đã thử rất nhiều lần <code class="language-plaintext highlighter-rouge">345YACCESSTOGENERATEP455</code> là passphrase nhưng không thành công và khác là stuck. Thì một người em của mình đã tìm ra vì envars là một trong những plugin của volatility.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="nv">$python2</span> vol.py <span class="nt">-f</span> challenge.raw <span class="nt">--profile</span><span class="o">=</span>Win7SP1x64 envars | <span class="nb">grep </span>345YACCESSTOGENERATEP455
Volatility Foundation Volatility Framework 2.6.1
     308 csrss.exe            0x00000000003a1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     356 wininit.exe          0x000000000043a990 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     364 csrss.exe            0x0000000000181320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     392 winlogon.exe         0x000000000007e060 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     452 services.exe         0x0000000000341320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     460 lsass.exe            0x0000000000351320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     468 lsm.exe              0x0000000000231320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     560 svchost.exe          0x00000000001e1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     624 svchost.exe          0x0000000000311320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     724 svchost.exe          0x00000000001e1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     768 svchost.exe          0x0000000000171320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     792 svchost.exe          0x0000000000301320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     964 svchost.exe          0x0000000000351320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     284 svchost.exe          0x00000000001e1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1080 spoolsv.exe          0x0000000000161320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1112 svchost.exe          0x0000000000361320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1232 armsvc.exe           0x0000000000151320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1292 svchost.exe          0x0000000000371320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1784 taskhost.exe         0x00000000001c1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1856 dwm.exe              0x0000000000071320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1884 explorer.exe         0x00000000037cd6b0 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     512 StikyNot.exe         0x00000000003d1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     832 SSScheduler.ex       0x0000000000501320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1344 SearchIndexer.       0x000000000040a010 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1704 SearchProtocol       0x00000000001f1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     596 notepad.exe          0x00000000002b1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1724 notepad.exe          0x0000000000171320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    1852 sppsvc.exe           0x0000000000271320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     304 svchost.exe          0x000000000021d0e0 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     840 notepad.exe          0x0000000000361320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
     992 notepad.exe          0x0000000000221320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    2164 notepad.exe          0x0000000000301320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    2180 SearchFilterHo       0x00000000002a1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    2308 WmiPrvSE.exe         0x00000000003d1320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    2512 DumpIt.exe           0x0000000000081320 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
    2536 conhost.exe          0x00000000003ad7f0 345YACCESSTOGENERATEP455       pPaAsSpPhHrR445533
</pre></table></code></div></div><p>Decrypt thôi nào</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$gpg</span> <span class="nt">--import</span> b64.key
<span class="nv">$gpg</span> <span class="nt">-o</span> flag <span class="nt">--decrypt</span> flag.txt.asc
gpg: encrypted with 4096-bit RSA key, ID A986306FA47DE39A, created 2021-08-20
      <span class="s2">"SemahBA (Not too far to get what you want) &lt;SemahBA@fword.tech&gt;"</span>
<span class="nv">$cat</span> flag
We are so proud that we sent you to give him back his important file. 

The important thing was : 23b2e901f3c3c3827a70589efd046be8
</pre></table></code></div></div><p>OK flag đã gần hoàn thiện, chỉ còn thời gian gửi, mình có thử 1, 2 lần vì time from và date ở INBOX khác nhau và ra được flag hoàn thiện.</p><p>Flag: <code class="language-plaintext highlighter-rouge">FwordCTF{08202021-05:03_ctf.user_23b2e901f3c3c3827a70589efd046be8}</code></p><h2 id="elearning"><span class="mr-2">eLearning</span><a href="#elearning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/img/blog/fword2021/4-eLearning-debai.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/4-eLearning-debai.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Download: <a href="https://drive.google.com/file/d/1tfcLMAbBWH-KBnkCDAboXAswm5fZuIed/view?usp=sharing">Link 1</a>; <a href="https://mega.nz/file/dwxHXQJa#loOkmUJfr2c1MNoAlue62IJZX4zHpOsW_QrWWdEUdlw">Link 2</a>; <a href="https://www.dropbox.com/s/chp4g30onaumjnm/Challenge2.zip?dl=0">Link 3</a></p><p>Đề bài ta một file ảnh nên mình dùng Autospy để trích xuất dữ liệu.</p><p><a href="/assets/img/blog/fword2021/5-autospy.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/5-autospy.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Sau khi để ý ở Program Files có ứng dụng Mailbird, mình google ra được đường dẫn lưu trữ là <code class="language-plaintext highlighter-rouge">\Users\fword\AppData\Local\Mailbird\Store</code>. Ở đây chúng ta xuất ra được file lưu trữ email là Store.db, sử DB Browser, mình có được thông tin:</p><p><a href="/assets/img/blog/fword2021/6-sender.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/6-sender.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Vậy là đã có được thông tin của giảng viên. Phần còn lại mình đã kiếm log của dirsearch và zenmap nhưng không cho thêm kết quả gì. Thử sử dụng lịch sử powershell: <code class="language-plaintext highlighter-rouge">%APPDATA%\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt</code> ta thu được:</p><pre><code class="language-Powershell">New-Item -ItemType Diretory -Path C:\users\fword\lab01
New-Item -ItemType Directory -Path C:\users\fword\lab01
ls
cd .\lab01\
nmap -sC -sV 192.168.1.9
cd ..\Downloads\dirsearch-master\dirsearch-master\
echo "192.168.1.9          lab01.fword" &gt;&gt; C:\Windows\System32\drivers\etc\hosts
ls
python .\dirsearch.py -u http://lab01.fword -e txt,php 
cd
cd C
cd C:\
cd
cd C
cd C:\
cd
cd C
cd C:\
cd
cd C
cd C:\
cd
cd C
cd C:\
cd
cd C
cd C:\
cd
cd C
cd C:\Users\fword\
wget http://lab01.fword/secret/secret.txt
Rename-Item -Path "c:\Users\fword\secret.txt" -NewName "file.txt"
</code></pre><p>Vậy là có thêm các tools đã dùng: dirsearch-nmap-wget. Tiếp theo ta đọc file.txt ở thử mục Document: <code class="language-plaintext highlighter-rouge">663cd2dfc9418f384d90c89a15319b3d</code></p><p>Flag: <code class="language-plaintext highlighter-rouge">FwordCTF{SBA_192.168.1.9_dirsearch-nmap-wget_secret.txt_663cd2dfc9418f384d90c89a15319b3d}</code></p><h2 id="shshsh"><span class="mr-2">shshsh</span><a href="#shshsh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Lại là một thử thách về memory forensics.</p><p>Tuy nhiên thử thách này lại không có bất kì process hay thông tin gì khả nghi. Nên mình thử kiểm tra biến môi trường.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python vol.py <span class="nt">-f</span> chall.vmem <span class="nt">--profile</span><span class="o">=</span>WinXPSP2x86 envars

....

1552 explorer.exe         0x00010000 k1                             12a45652a154a358452124565487ad0
1552 explorer.exe         0x00010000 iv                             k1
1552 explorer.exe         0x00010000 KT                             AES128-CBC
1552 explorer.exe         0x00010000 LOGONSERVER                    <span class="se">\\</span>CTFCREATORS-DF

....
</pre></table></code></div></div><p>Chúng ta có key và iv của thuật toán mã hóa AES128-CBC; tuy nhiên lại không có tệp mã hóa.</p><p>Đoạn này thì mình cũng mò mãi đến lúc sau thì mới thấy bỏ xót 1 phần quan trọng trong các biến môi trường:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>1552 explorer.exe         0x00010000 PATHEXT                        .HAK<span class="p">;</span>.COM<span class="p">;</span>.EXE<span class="p">;</span>.BAT<span class="p">;</span>.CMD<span class="p">;</span>.VBS<span class="p">;</span>.VBE<span class="p">;</span>.JS<span class="p">;</span>.JSE<span class="p">;</span>.WSF<span class="p">;</span>
</pre></table></code></div></div><p>Chỉ duy nhất PATHEXT của explorer là có đuôi mở rộng rất lạ là .HAK; thử tìm xem có bao nhiêu file .HAK nào.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python vol.py <span class="nt">-f</span> chall.vmem <span class="nt">--profile</span><span class="o">=</span>WinXPSP2x86 filescan | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">".HAK"</span>
Volatility Foundation Volatility Framework 2.6.1
0x00000000012403d8      1      0 <span class="nt">-W-rw-</span> <span class="se">\D</span>evice<span class="se">\H</span>arddiskVolume1<span class="se">\W</span>INDOWS<span class="se">\s</span>ystem32<span class="se">\H</span>andles.HAK
0x000000000198c0d0      2      2 R--rw- <span class="se">\D</span>evice<span class="se">\H</span>arddiskVolume1<span class="se">\W</span>INDOWS<span class="se">\s</span>ystem32<span class="se">\H</span>andles.HAK

<span class="nv">$ </span>python vol.py <span class="nt">-f</span> chall.vmem <span class="nt">--profile</span><span class="o">=</span>WinXPSP2x86 dumpfiles <span class="nt">-Q</span> 0x00000000012403d8 <span class="nt">-D</span> <span class="nb">.</span>

<span class="nv">$ </span>strings file.None.0x8144e990.dat 
<span class="nv">NDgwYjJmMzM4ZjY0N2M3ZTY1MjQwZTc2MjdjYWRhYmFjNWJkNWZjNjllNWQxZDMzM2ZlYjRlMjNjYzNhYjA5NGZlY2E1ODcxMjA5ODJmODExM2U0NTMzNjcxOThmMDU4MWJlZDNhZWMxNTBkMjg1NDIzYWUxMTFiN2I5NDkzNjExZmFjMmNmYmViYjg5NzkzY2U3MThjM2YxZTJkNWNlMjcwMmE5MWNjNDM4NzZhYjJmZGJjZjc0MmRlODg4M2Q2OTIzYjAwYTYyNTMzMGRhOWRiNjljNmFiYmU0ZjIxY2Y5NGJiZmMxMWU2MWJkZDc0NmVjNDU5OGRkNTQ2ZDk2YQo</span><span class="o">=</span>
</pre></table></code></div></div><p>Decrypt thôi nào <a href="/assets/img/blog/fword2021/9-shshsh.JPG" class="popup img-link "><img data-src="/assets/img/blog/fword2021/9-shshsh.JPG" alt="IMG" class="lazyload" data-proofer-ignore></a></p><p>Flag: <code class="language-plaintext highlighter-rouge">FwordCTF{y0u_CAN_Mak3_u5e_of_4ny_proCesS_with_tHe_ri9ht_apProach}</code></p><p>Cheer (☞ﾟヮﾟ)☞ ☜(ﾟヮﾟ☜)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/fwordctf-2021/'>FwordCTF 2021</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/forensics/" class="post-tag no-text-decoration" >forensics</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/fwordctf/" class="post-tag no-text-decoration" >FwordCTF</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Writeup]%20FwordCTF%202021%20-%20Forensics%20-%20WhiteBearVN&url=https%3A%2F%2Fblog.whitebear.vn%2Fposts%2FWriteup-FwordCTF-2021-Forensics%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Writeup]%20FwordCTF%202021%20-%20Forensics%20-%20WhiteBearVN&u=https%3A%2F%2Fblog.whitebear.vn%2Fposts%2FWriteup-FwordCTF-2021-Forensics%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[Writeup]%20FwordCTF%202021%20-%20Forensics%20-%20WhiteBearVN&url=https%3A%2F%2Fblog.whitebear.vn%2Fposts%2FWriteup-FwordCTF-2021-Forensics%2F" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/setup-a-website-with-apache-webserver-and-nginx-waf-reverse-proxy/">Set up website with apache webserver and nginx waf reverse proxy</a><li><a href="/posts/Writeup-VNPT-Secathon-2018/">[Writeup] VPNT Secathon 2018 - Misc</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/research/">research</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apache/">apache</a> <a class="post-tag" href="/tags/asis/">ASIS</a> <a class="post-tag" href="/tags/bsides/">BSides</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Writeup-BSides-Noida-CTF-2021-Deathnote/"><div class="card-body"> <em class="small" data-ts="1628355600" data-df="ll" > Aug 8, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Writeup] BSides Noida CTF 2021 - Deathnote</h3><div class="text-muted small"><p> Bài này cho chúng ta 1 vuln box trên tryhackme và nhiệm vụ là phải cat được flag trong root folder. Đầu tiên, mình dùng nmap để xem các port đang mở trên box này. $ nmap -vv -sV -sT -sC 10.10.164....</p></div></div></a></div><div class="card"> <a href="/posts/Writeup-VNPT-Secathon-2018/"><div class="card-body"> <em class="small" data-ts="1521478800" data-df="ll" > Mar 20, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Writeup] VPNT Secathon 2018 - Misc</h3><div class="text-muted small"><p> Chayngaydi Trong bài này ban tổ chức cho chúng ta đoạn teaser trailer Chạy ngay đi của Sếp. Ngay khi nhìn vào dung lượng của tập tin mp4, thì mình biết chắc chắn rằng nó đang giấu một file gì đ...</p></div></div></a></div><div class="card"> <a href="/posts/Mates-SS2-Round-4-Forensics-caigidzay/"><div class="card-body"> <em class="small" data-ts="1525107600" data-df="ll" > May 1, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Writeup] Mates SS2 Round 4 - Forensics caigidzay</h3><div class="text-muted small"><p> Trong thử thách này để bài là một file dump, mbr/dos nên mình sẽ dùng auto spy để mở nó xem sao. Đập vào mắt mình là flag.jpg. Mình tốn kha khá thời gian với bức ảnh này vì lúc đầu tưởng đây là ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Writeup-corCTF-2021/" class="btn btn-outline-primary" prompt="Older"><p>[Writeup] corCTF 2021</p></a> <a href="/posts/Quick-note/" class="btn btn-outline-primary" prompt="Newer"><p>My note for quick to use</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/research/">research</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/apache/">apache</a> <a class="post-tag" href="/tags/asis/">ASIS</a> <a class="post-tag" href="/tags/bsides/">BSides</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/WhiteBearVN_">WhiteBearVN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
